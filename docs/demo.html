<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GradeView - Time Sorting Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h1 {
            font-size: 28px;
            font-weight: 600;
        }
        .header .student-info {
            font-size: 14px;
            opacity: 0.9;
        }
        .toggle-buttons {
            display: flex;
            gap: 10px;
            background: white;
            border-radius: 8px;
            padding: 4px;
        }
        .toggle-btn {
            padding: 10px 20px;
            border: none;
            background: transparent;
            color: #667eea;
            cursor: pointer;
            border-radius: 6px;
            font-weight: 500;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .toggle-btn:hover {
            background: rgba(102, 126, 234, 0.1);
        }
        .toggle-btn.active {
            background: #667eea;
            color: white;
        }
        .content {
            padding: 30px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }
        .stat-card .label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 8px;
        }
        .stat-card .value {
            font-size: 32px;
            font-weight: 700;
        }
        .table-container {
            overflow-x: auto;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        thead {
            background: #f9fafb;
            position: sticky;
            top: 0;
        }
        th {
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 2px solid #e5e7eb;
        }
        td {
            padding: 16px;
            border-bottom: 1px solid #e5e7eb;
        }
        tbody tr:hover {
            background: #f9fafb;
        }
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 600;
        }
        .grade-A { background: rgba(76, 175, 80, 0.2); color: #4caf50; }
        .grade-B { background: rgba(139, 195, 74, 0.2); color: #8bc34a; }
        .grade-C { background: rgba(255, 193, 7, 0.2); color: #ffc107; }
        .grade-D { background: rgba(255, 152, 0, 0.2); color: #ff9800; }
        .grade-F { background: rgba(244, 67, 54, 0.2); color: #f44336; }
        .category-badge {
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 500;
            background: #e5e7eb;
            color: #374151;
        }
        .loading {
            text-align: center;
            padding: 60px;
            color: #6b7280;
        }
        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .late {
            color: #f44336;
            font-size: 12px;
            display: block;
            margin-top: 4px;
        }
        .time-col {
            font-size: 13px;
            color: #6b7280;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>üéì Student Profile</h1>
                <div class="student-info" id="studentInfo">Loading...</div>
            </div>
            <div class="toggle-buttons">
                <button class="toggle-btn active" onclick="switchMode('assignment')">
                    üìÅ By Assignment
                </button>
                <button class="toggle-btn" onclick="switchMode('time')">
                    ‚è±Ô∏è By Time
                </button>
            </div>
        </div>

        <div class="content">
            <div class="stats" id="stats">
                <div class="stat-card">
                    <div class="label">Total Score</div>
                    <div class="value" id="totalScore">-</div>
                </div>
                <div class="stat-card">
                    <div class="label">Percentage</div>
                    <div class="value" id="percentage">-</div>
                </div>
                <div class="stat-card">
                    <div class="label">Grade</div>
                    <div class="value" id="grade">-</div>
                </div>
                <div class="stat-card">
                    <div class="label">Total Assignments</div>
                    <div class="value" id="totalAssignments">-</div>
                </div>
            </div>

            <div id="tableContainer"></div>
        </div>
    </div>

    <script>
        let currentMode = 'assignment';
        const studentEmail = 'jippebraams@berkeley.edu';
        const API_BASE = 'http://localhost:3001/api/v2';

        function getGrade(percentage) {
            if (percentage >= 90) return { grade: 'A', class: 'grade-A' };
            if (percentage >= 80) return { grade: 'B', class: 'grade-B' };
            if (percentage >= 70) return { grade: 'C', class: 'grade-C' };
            if (percentage >= 60) return { grade: 'D', class: 'grade-D' };
            return { grade: 'F', class: 'grade-F' };
        }

        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        async function loadData(mode) {
            const url = mode === 'time' 
                ? `${API_BASE}/students/${encodeURIComponent(studentEmail)}/grades?sort=time`
                : `${API_BASE}/students/${encodeURIComponent(studentEmail)}/grades`;

            document.getElementById('tableContainer').innerHTML = '<div class="loading"><div class="spinner"></div>Loading data...</div>';

            try {
                const response = await fetch(url);
                const data = await response.json();
                
                if (mode === 'time') {
                    displayTimeSortedData(data);
                } else {
                    displayAssignmentData(data);
                }
            } catch (error) {
                document.getElementById('tableContainer').innerHTML = `<div class="loading" style="color: #f44336;">Error: ${error.message}</div>`;
            }
        }

        function displayTimeSortedData(data) {
            const submissions = data.submissions || [];
            
            // Calculate stats
            const totalScore = submissions.reduce((sum, s) => sum + s.score, 0);
            const totalMax = submissions.reduce((sum, s) => sum + s.maxPoints, 0);
            const percentage = totalMax > 0 ? (totalScore / totalMax * 100) : 0;
            const gradeInfo = getGrade(percentage);

            updateStats(totalScore, totalMax, percentage, gradeInfo.grade, submissions.length);
            document.getElementById('studentInfo').textContent = `${studentEmail} - Sorted by Submission Time`;

            let html = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Category</th>
                                <th>Assignment</th>
                                <th>Score</th>
                                <th>Max</th>
                                <th>%</th>
                                <th>Grade</th>
                                <th>Submitted</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            submissions.forEach((s, idx) => {
                const gradeInfo = getGrade(s.percentage);
                const late = s.lateness && s.lateness !== '00:00:00' ? `<span class="late">Late: ${s.lateness}</span>` : '';
                
                html += `
                    <tr>
                        <td>${idx + 1}</td>
                        <td><span class="category-badge">${s.category}</span></td>
                        <td>${s.name}</td>
                        <td>${s.score.toFixed(2)}</td>
                        <td>${s.maxPoints.toFixed(2)}</td>
                        <td><span class="badge ${gradeInfo.class}">${s.percentage.toFixed(1)}%</span></td>
                        <td><span class="badge ${gradeInfo.class}">${gradeInfo.grade}</span></td>
                        <td class="time-col">${formatDate(s.submissionTime)}${late}</td>
                    </tr>
                `;
            });

            html += `
                        </tbody>
                    </table>
                </div>
            `;

            document.getElementById('tableContainer').innerHTML = html;
        }

        function displayAssignmentData(data) {
            // Simple display for assignment mode
            const assignments = [];
            let totalScore = 0;
            let totalMax = 0;

            Object.entries(data).forEach(([category, items]) => {
                Object.entries(items).forEach(([name, info]) => {
                    if (info.max > 0) {
                        assignments.push({
                            category,
                            name,
                            score: info.student,
                            max: info.max,
                            percentage: (info.student / info.max) * 100
                        });
                        totalScore += info.student;
                        totalMax += info.max;
                    }
                });
            });

            const percentage = totalMax > 0 ? (totalScore / totalMax * 100) : 0;
            const gradeInfo = getGrade(percentage);

            updateStats(totalScore, totalMax, percentage, gradeInfo.grade, assignments.length);
            document.getElementById('studentInfo').textContent = `${studentEmail} - Sorted by Assignment`;

            let html = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Category</th>
                                <th>Assignment</th>
                                <th>Score</th>
                                <th>Max</th>
                                <th>%</th>
                                <th>Grade</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            assignments.forEach((a, idx) => {
                const gradeInfo = getGrade(a.percentage);
                
                html += `
                    <tr>
                        <td>${idx + 1}</td>
                        <td><span class="category-badge">${a.category}</span></td>
                        <td>${a.name}</td>
                        <td>${a.score.toFixed(2)}</td>
                        <td>${a.max.toFixed(2)}</td>
                        <td><span class="badge ${gradeInfo.class}">${a.percentage.toFixed(1)}%</span></td>
                        <td><span class="badge ${gradeInfo.class}">${gradeInfo.grade}</span></td>
                    </tr>
                `;
            });

            html += `
                        </tbody>
                    </table>
                </div>
            `;

            document.getElementById('tableContainer').innerHTML = html;
        }

        function updateStats(totalScore, totalMax, percentage, grade, count) {
            document.getElementById('totalScore').textContent = `${totalScore.toFixed(0)}/${totalMax.toFixed(0)}`;
            document.getElementById('percentage').textContent = `${percentage.toFixed(1)}%`;
            document.getElementById('grade').textContent = grade;
            document.getElementById('totalAssignments').textContent = count;
        }

        function switchMode(mode) {
            currentMode = mode;
            
            // Update button styles
            document.querySelectorAll('.toggle-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.closest('.toggle-btn').classList.add('active');

            // Load data
            loadData(mode);
        }

        // Initial load
        loadData('assignment');
    </script>
</body>
</html>
